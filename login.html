<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bouncrrr</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="bouncrrr-favicon.ico" type="image/x-icon">
</head>
<body class="info-page">
    <div id="background-animation"></div>
    <div class="navbar navbar-visible" id="navbar">
        <a href="index.html">home</a>
    </div>
    <header>
        <h2 id="formTitle">login to get started!</h2>
    </header>
    <div class="login-container">
        <center>
            <form id="loginForm">
                <div>
                    <label for="email">email:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div>
                    <label for="password">password:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div id="confirmPasswordContainer" style="display: none;">
                    <label for="confirmPassword">confirm password:</label>
                    <input type="password" id="confirmPassword" name="confirmPassword">
                </div>
    <div id="loginError" class="error"></div> <!-- Ensure this is inside the login-container but outside the center tag -->
                <div>
                    <p><a style="text-decoration:none; color:inherit;" href="forgotpassword.html">forgot password?</a></p>
                    <br>
                    <button type="submit" id="submitButton">login</button>
                </div>
                <div>
                    <button type="button" id="toggleFormButton">don't have an account? sign up</button>
                </div>
            </form>
        </center>
        <div id="loginError" class="error"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const toggleButton = document.getElementById('toggleFormButton');
    const formTitle = document.getElementById('formTitle');
    const confirmPasswordContainer = document.getElementById('confirmPasswordContainer');
    const submitButton = document.getElementById('submitButton');
    const loginError = document.getElementById('loginError');

    toggleButton.addEventListener('click', function() {
        if (formTitle.innerText.includes('login')) {
            formTitle.innerText = 'sign up to get started!';
            confirmPasswordContainer.style.display = 'block';
            submitButton.textContent = 'sign up';
            toggleButton.textContent = 'already have an account? log in';
        } else {
            formTitle.innerText = 'login to get started!';
            confirmPasswordContainer.style.display = 'none';
            submitButton.textContent = 'login';
            toggleButton.textContent = "don't have an account? sign up";
        }
    });

    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword') ? document.getElementById('confirmPassword').value : null;

        // Determine endpoint based on the presence of the confirmPassword
        let apiEndpoint = confirmPassword ? 'https://paddle-cockroach-bouncrrr.onrender.com/api/signup' : 'https://paddle-cockroach-bouncrrr.onrender.com/api/login';
        let payload = JSON.stringify({ email, password, confirmPassword });

        fetch(apiEndpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: payload,
        })
        .then(response => response.json())
        .then(data => {
            if (data.token) {
                localStorage.setItem('userToken', data.token);
                localStorage.setItem('userEmail', email);
                const params = new URLSearchParams(window.location.search);
                const returnUrl = params.get('returnUrl');
                window.location.href = returnUrl || '/index.html'; // Redirect after login
            } else if (data.message && data.status === 'success') {
                loginError.textContent = data.message; // Success message from server (e.g., check your email)
            } else {
                loginError.textContent = data.error || 'incorrect email/password. please check your credentials.';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            loginError.textContent = error.message || 'an error occurred. Please try again.';
        });
    });
});
</script>
<footer>
        <a href="privacy.html">privacy notice</a> | 
        <a href="support.html">support</a> | 
        <a href="terms.html">terms of use/refund policy</a>
    </footer>
</body>
</html>
