<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bouncrrr</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="bouncrrr-favicon.ico" type="image/x-icon">
    <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
    <script>
    Paddle.Environment.set('sandbox'); // Ensure you're in the correct environment
    Paddle.Initialize({
        token: 'test_241b28ddc2c6acc634ee5dd479f', // Replace with your actual client-side token
    });
    console.log('Paddle.js initialized');

    document.addEventListener('DOMContentLoaded', function() {
        console.log('Document loaded');

        checkLoginStatus();  // Check login status on page load
        fetchAndDisplayPrices(); // Fetch and display prices on page load

        const logoutButton = document.getElementById('logout-button');
        if (logoutButton) {
            logoutButton.addEventListener('click', handleLogout);
        }
    });

    function checkLoginStatus() {
        const userEmail = localStorage.getItem('userEmail');
        if (userEmail) {
            document.getElementById('login-status').textContent = `logged in as ${userEmail}`;
            document.getElementById('login-link').style.display = 'none';
            document.getElementById('logout-text').style.display = 'inline';
            document.getElementById('manage-account').style.display = 'inline'; // Show manage account link
            checkSubscriptionStatus();
        } else {
            document.getElementById('login-status').textContent = 'log in';
            document.getElementById('login-link').style.display = 'inline';
            document.getElementById('logout-text').style.display = 'none';
            document.getElementById('manage-account').style.display = 'none'; // Hide manage account link
        }
    }

    function checkSubscriptionStatus() {
        const token = localStorage.getItem('userToken');
        if (!token) {
            console.error('User token is missing.');
            return;
        }

        fetch('https://paddle-cockroach-bouncrrr.onrender.com/api/get-subscription-status', {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${token}` }
        })
        .then(response => response.json())
        .then(data => {
            updatePricingSection(data.status); // Update the pricing section based on subscription status
        })
        .catch(error => console.error('Failed to fetch subscription status:', error));
    }

    function updatePricingSection(status) {
            const pricingContainer = document.querySelector('.pricing-container');
            if (status === 'active') {
                document.querySelectorAll('.pricing-tier:not(.special)').forEach(el => el.style.display = 'none');
                const message = document.createElement('p');
                message.textContent = "You're already subscribed! But you can still buy a lifetime license...";
                message.style.color = 'white';
                message.style.fontSize = '20px';
                message.style.textAlign = 'center';
                const pricingHeader = document.getElementById('pricing-header');
                pricingHeader.after(message);
            }
        }

    function handleLogout() {
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userToken');
        localStorage.removeItem('paddleCustomerId');
        window.location.href = 'index.html';
    }

    function fetchAndDisplayPrices() {
        var request = {
            items: [
                { quantity: 1, priceId: 'pri_01htk0e7exyc33gr8qvaxnf96s' },
                { quantity: 1, priceId: 'pri_01htk4dhmz6ngkhysj1c8rm6ah' },
                { quantity: 1, priceId: 'pri_01htk4feeptfk9fsw9zevx9mg5' }
            ],
            address: { countryCode: 'GB' }
        };

        Paddle.PricePreview(request)
            .then((result) => {
                console.log("Paddle.PricePreview success:", result);
                updatePricingDisplays(result);
            })
            .catch((error) => {
                console.error('Error fetching pricing from Paddle.PricePreview:', error);
            });
    }

    function updatePricingDisplays(data) {
        const lineItems = data.data.details.lineItems;
        const monthlyItem = lineItems.find(item => item.price.id === 'pri_01htk0e7exyc33gr8qvaxnf96s');
        const annualItem = lineItems.find(item => item.price.id === 'pri_01htk4dhmz6ngkhysj1c8rm6ah');
        const lifetimeItem = lineItems.find(item => item.price.id === 'pri_01htk4feeptfk9fsw9zevx9mg5');

        if (monthlyItem) {
            document.getElementById('monthly-price').textContent = monthlyItem.formattedUnitTotals.total + '/month';
        }
        if (annualItem) {
            document.getElementById('annual-price').textContent = annualItem.formattedUnitTotals.total + '/year';
        }
        if (lifetimeItem) {
            document.getElementById('lifetime-price').textContent = lifetimeItem.formattedUnitTotals.total;
        }
    }
</script>
</head>
<body>
    <div id="background-animation"></div>

<div class="login-status-container">
    <div>
        <span id="login-status">log in</span>
        <a href="login.html" id="login-link">log in</a>
        <span id="logout-text" style="display:none;"><a href="#" id="logout-button" class="logout-button">log out</a></span>
    </div>
    <div style="display:none;" id="manage-account">
        <a href="/account-management.html" class="manage-account">manage your account/subscription</a>
    </div>
</div>

    <div class="navbar" id="navbar">
        <a href="#intro">intro</a>
        <a href="#what-bouncrrr-does">what it does</a>
        <a href="#how-does-it-do-it">how it works</a>
        <a href="#setup">setup</a>
        <a href="#pricing">pricing</a>
        <a href="#contact">contact</a>
    </div>
    <header>
        <h1>bouncrrr</h1>
	    <h2>bounce smarter. not harder.</h2>
    </header>
    <div class="arrow" id="arrow-container">
        <div class="arrow" id="arrow"></div>
    </div>

<header>
        <h2>be the first to know when bouncrrr launches!</h2>
    </header>
    <main class="emailsignup-page">
<center>    <form id="signup-form">
        <input type="email" id="email" placeholder="enter your email" required>
        <button type="submit">notify me</button>
    </form></center>
    <script src="email-signup.js"></script>
</main>
    <main>
        <section id="intro">
            <h3>how much is your time worth?</h3>
    <div id="animation-trigger"></div> <!-- Marker for ScrollMagic trigger -->
    <div id="emoji-container"></div> <!-- Positioned outside but close to the text trigger -->
        </section>
        <section>
            <h3>how much of it have you wasted waiting for stems to bounce?</h3>
        </section>
<div id="image-animation-container"></div>
    <div id="image-animation-trigger"></div>
        <section id="what-bouncrrr-does">
            <h2>what bouncrrr does</h2>
            <img src="https://raw.githubusercontent.com/bouncrrr/bouncrrr.github.io/main/MainWindow.png" alt="bouncrrr main window" class="main-window-image">
            <p>bouncrrr automates the process of bouncing stems in logic pro, saving producers, engineers, and artists hours (or even DAYS) of manual work.</p>
        </section>
        <section id="how-does-it-do-it">
            <h2>how does it do it?</h2>
            <img src="https://raw.githubusercontent.com/bouncrrr/bouncrrr.github.io/main/Options%20Menu.png" alt="options menu" class="main-window-image">
            <p>bouncrrr uses a complex code to automate the process, bouncing each stem one by one.</p>
        </section>
        <section id="setup">
            <h2>how much setup do i need to do?</h2>
            <img src="https://raw.githubusercontent.com/bouncrrr/bouncrrr.github.io/main/bouncrrr%20setup%20track.png" alt="bouncrrr setup" class="main-window-image"> <!-- Replace # with your image URL -->
            <p>the setup for bouncrrr is minimal, involving a small preparation process for each project.</p>
        </section>
        <section>
            <h2>is this just another gimmick that isn't really going to work?</h2>
            <img src="https://raw.githubusercontent.com/bouncrrr/bouncrrr.github.io/main/Logic%20Pro%20Lost%20Focus.png" alt="Logic Pro Lost Focus" class="main-window-image">
            <p>a lot of time and effort has gone specifically into making sure that bouncrrr is reliable and doesn't crash.</p>
<p>if the bouncing process gets knocked off course, you'll be alerted and given the option to resume from where you left off.</p>
<p>bouncrrr was created by a producer and mix engineer who was fed up of half solutions and false promises, so reliability was a priority.</p>
        </section>
        <section id="pricing">
    <h2 class="large-heading">pricing</h2>
    
<div class="pricing-container">

    <div class="pricing-tier">
        <h4>monthly subscription</h4>
        <p class="small-text">low monthly cost</p>
        <p class="small-text">cancel at any time</p>
        <p class="small-text">all of bouncrrr's current features</p>
        <!-- Assign an ID for the monthly price paragraph -->
        <p id="monthly-price">s£8.99/month</p>
        <p class="small-text">(billed monthly)</p>
        <button id="subscribe-button-monthly">subscribe</button>
    </div>
    <div class="pricing-tier">
        <h4>annual subscription</h4>
        <p class="small-text">saves money vs monthly</p>
        <p class="small-text">no monthly costs to worry about</p>
	<p class="small-text">priority support</p>
        <!-- Assign an ID for the annual price paragraph -->
        <p id="annual-price">£75/year (billed annually)</p>
        <p class="small-text">(equivalent of £6.25/month)</p>
        <button id="subscribe-button-annual">subscribe</button>
    </div>
    <div class="pricing-tier special">
        <h4>lifetime license</h4>
        <p class="small-text">best value for money</p>
        <p class="small-text">no subscriptions to worry about</p>
        <p class="small-text">priority support</p>
        <!-- Assign an ID for the lifetime price paragraph -->
        <p id="lifetime-price"><span class="original-price">£150</span> £90</p>
	<p class="small-text">(one time fee, no hidden charges)</p>
        <div class="badge">★ INTRODUCTORY PRICING!</div>
        <button id="buy-button-lifetime">buy now</button>
    </div>
    <div class="pricing-tier">
        <h4>trial</h4>
        <p class="small-text">free fully functional 7 day trial with each subscription</p>
        <p class="small-text">try before you buy!</p>
	<p class="small-text">make sure bouncrrr is for you</p>
        <!-- Assign an ID for the annual price paragraph -->
        <p id="free-price">free!</p>
        <p class="small-text">(you'll want to buy it though!)</p>
        <button id="subscribe-button-annual">subscribe</button>
    </div>

</div>

        </section>
        <section id="contact">
            <h2>contact</h2>
            <p>email us at <a href="mailto:hello@bouncrrr.co">hello@bouncrrr.co</a></p>
        </section>
    </main>
    <footer>
        <a href="privacy.html">privacy notice</a> | 
        <a href="support.html">support</a> | 
        <a href="terms.html">terms of use/refund policy</a>
    </footer>
	<script>
	document.addEventListener('DOMContentLoaded', function() {
    	// Function to handle subscription attempts
    	function handleSubscription(priceId) {
        	const isLoggedIn = localStorage.getItem('userToken');
        	const userEmail = localStorage.getItem('userEmail');  // Retrieve the userEmail from localStorage

        if (!isLoggedIn) {
            // Redirect to the login page and append the return URL
            window.location.href = 'login.html?returnUrl=' + encodeURIComponent(window.location.href + '#pricing');
        } else {
            // Ensure userEmail is retrieved and defined
            if (!userEmail) {
                console.error('User email not found in local storage');
                return;  // Exit the function if userEmail isn't found
            }
            // Open the Paddle checkout with the specific priceId
            const passthroughData = JSON.stringify({ userEmail: userEmail });
        console.log('Passthrough data being sent to Paddle:', passthroughData); // Log the passthrough data

        Paddle.Checkout.open({
            items: [
                { priceId: priceId, quantity: 1 }
            ],
            customData: JSON.stringify({
                userEmail: userEmail // Passing the userEmail in customData
            }),
            successCallback: function(data) {
                console.log('Checkout success:', data);
            },
            closeCallback: function() {
                console.log('Checkout closed.');
            }
        });
        }
    }

    // Attach the event listener to each subscription button with their specific priceId
    document.getElementById('subscribe-button-monthly').addEventListener('click', () => handleSubscription('pri_01htk0e7exyc33gr8qvaxnf96s'));
    document.getElementById('subscribe-button-annual').addEventListener('click', () => handleSubscription('pri_01htk4dhmz6ngkhysj1c8rm6ah'));
    document.getElementById('buy-button-lifetime').addEventListener('click', () => handleSubscription('pri_01htk4feeptfk9fsw9zevx9mg5'));
    document.getElementById('subscribe-button-trial').addEventListener('click', () => handleSubscription('pri_01htk0e7exyc33gr8qvaxnf96s')); // Assuming it uses the same price ID as the monthly one
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.min.js"></script>
    <script src="script.js"></script>

</body>
</html>
